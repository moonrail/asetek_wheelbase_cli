from dataclasses import dataclass
from ._base import HidData, WheelbaseConfiguration, WheelbaseDefinition


@dataclass
class LaPrimaWheelbaseConfiguration(WheelbaseConfiguration):
    ...


la_prima_wheelbase = WheelbaseDefinition(
    name='La Prima',
    product_id=0xf303,
    configuration_class=LaPrimaWheelbaseConfiguration,
    send_report_id=0x6b,
    answer_report_id=0x6c,
    get_configuration_hid_data=HidData('000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'),
    enable_high_torque_hid_data=[
        HidData('97006bb71700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', expect_answer=False),
        HidData('980000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'),
        # Answers in three High Torque On/Off-Cycles are different, as well as the last hid data to send
        # 1st answer: 990000b71700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a5a500
        # 2nd answer: 990000b717000000000000000000000000000000000bd32d100000000000000000000000000000000000000000000000000000000000000000a5a500
        # 3rd answer: 990000b71700000000000000000000000000000000ffff8c0f0000000000000000000000000000000000000000000000000000000000000000a5a500
        HidData('96006bb71700000000000000000000000000000000e28a63090000000000000000000000000000000000000000000000000000000000000000000000', expect_answer=False),
        # 2nd data to send: 96006bb71700000000000000000000000000000000bfd099020000000000000000000000000000000000000000000000000000000000000000000000
        # 3rd data to send: 96006bb7170000000000000000000000000000000093723d1e0000000000000000000000000000000000000000000000000000000000000000000000
    ],
    disable_high_torque_hid_data=[
        HidData('96006bb71700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', expect_answer=False)
    ],
    get_profile_name_hid_data=HidData('72{profile_id:02x}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'),
    set_profile_hid_data=HidData(
        '26{profile_id:02x}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
        expect_answer=False
    )
)


"""
High Torque sequences change - why?
1st
answer to 2nd hid data: 000000000 / 00000000000000000000000000000000
following request: 3800720137 / 11100010100010100110001100001001

2nd
a: 198389008 / 00001011110100110010110100010000
fr: 3218118914 / 10111111110100001001100100000010

3rd
a: 4294937615 / 11111111111111111000110000001111
fr: 2473737502 / 10010011011100100011110100011110
"""


"""
# unknown if this is relevant - more for debug purposes and as reference
racehub_startup_packets = (
    '0b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '710000010002000300040005000600070008000900000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '7100000a000b000c000d000e000f00100011001200000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '7100001300180019001a001b001c001d0032000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '730000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '710100010002000300040005000600070008000900000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '7101000a000b000c000d000e000f00100011001200000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '7101001300180019001a001b001c001d0032000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '720100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '730100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '6e000001000200030009000a000c000e0010001300000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '6e0000140015001600320039003a003b003c003d00000000000000000000000000000000000000000000000000000000000000000000000000000000',
    '6e00003e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    'd30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
)
"""
"""
010000000018310b000000000000000100030001000400010200000000000000000000000000000000000000000000000000000014040000a5a5a500
# after profile creation temporarily with 15 instead of 14
010000000018310b000000000000000100030001000400010200000000000000000000000000000000000000000000000000000015040000a5a5a500
"""
"""
# get profile name
wheelbase.send_hid_report(
    hid_hex_data=f'72{profile_id:02x}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
)
profile_hid_hex_data = wheelbase.read_hid_report()
found_data = False
concated_hex = ''
for byte_index in range(4, len(profile_hid_hex_data), 2):
    hex = profile_hid_hex_data[byte_index:byte_index + 2]
    if hex == '00':
        if found_data:
            break
        continue
    found_data = True
    concated_hex += hex
print(concated_hex)
print(bytes.fromhex(concated_hex).decode())
"""
